<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Send FFF Ticket V2</title>

    <link rel="stylesheet" href="../bootstrap/css/bootstrap.min.css">

    <!-- <style>
        @media print {
            body, h1, h2, h3, ol, ul, div, span, p {
                display: block !important;
                width: auto !important;
                float: none !important;
                position: static !important;
                overflow: visible !important;
                /* border: 0.5px solid red !important; */
            }

        }
    </style> -->
  </head>
  <body>
    <div class="container-fluid">
      <main class="row"></main>
    </div>

    <script src="../bootstrap/js/bootstrap.min.js"></script>
    <script>
      const mainEl = document.querySelector("main");

      async function run() {
        const response = await fetch(
          "https://raw.githubusercontent.com/echomalik/echomalik.github.io/master/fff/data.json"
        );

        const arr = await response.json();

        console.log(arr);

        return arr.map((a) => ({
          namaAnak: a["Nama Anak"],
          code: a["QR Code"],
          imgSrc: `https://quickchart.io/qr?text=${a["QR Code"]}&margin=2&size=200`,
        }));
      }

      run().then((arr) => {
        arr.forEach((qr) => {
          qr.namaAnak;
          const div = document.createElement("div");
          div.classList.add(
            "col-6",
            "col-md-4",
            "col-lg-3",
            "border",
            "border-dark",
            );
          // div.style.height = '3.56666666667in';
          div.innerHTML = `
            <img class="d-block mx-auto img-fluid" src="${qr.imgSrc}">
            <h4 class="text-center">${qr.code}</h4>
            <h5 class="text-center mb-0">${qr.namaAnak}</h5>
            <form onsubmit="return sendTicket('${qr.code}')">
              <div class="m-auto">
                <div class="input-group mb-2">
                  <span class="input-group-text">+62</span>
                  <input id="number-${qr.code}" class="form-control" type="text"> 
                </div>
                <div class="mb-2">
                  <input type="submit" class="btn btn-success col-12" value="Send">
                </div>
              </div>
            </form>            
            
        `;
          mainEl.appendChild(div);
        });
      });

      function sendTicket(qrcode){
        // console.log(qrcode);

        const number = document.getElementById('number-'+qrcode)
        const wa = "https://wa.me/";
        const text = "text=";
        const barcode_url = "https://echomalik.github.io/fff/barcode/index.html"
        const encoded_text = encodeURIComponent(barcode_url+"?qrcode="+qrcode+"&qrlink="+encodeURIComponent("https://quickchart.io/qr?text="+qrcode+"&margin=2&size=200"))
        const waMe = wa+"62"+number.value+"?"+text+encoded_text
        // console.log(number.value)
        // console.log(waMe)

        window.open(waMe)

        return false;
        
      }
    </script>
  </body>
</html>